---
layout:     post
title:      hive窗口函数
subtitle:   hive窗口函数
date:       2018-11-23
author:     XINGXING
header-img: img/post-bg-ios9-web.jpg
catalog: true
tags:
    - Hive
---

>
>hive函数
> 

**环境准备**
```sql
create external table test(
channel_id string,
updatetime string,
pv int 
) row format delimited fields terminated by ',' 
stored as textfile location '/tmp/test'

``` 


**SUM函数**  
PARTITION BY user_id: 表示根据user_id分组  
ORDER BY registtime: 表示根据registtime排序，默认升序  
ROWS BETWEEN ... AND ...:  指定范围  
UNBOUNDED PRECEDING:表示从起点开始  
UNBOUNDED FOLLOWING:表示后面行的终点结束  
CURRENT ROW：表示当前行  
PRECEDING：表示向前  
FOLLOWING：表示向后  

```sql
SELECT channel_id,
updatetime,
pv,
SUM(pv) OVER(PARTITION BY channel_id ORDER BY updatetime) AS pv1, -- 默认为从起点到当前行
SUM(pv) OVER(PARTITION BY channel_id ORDER BY updatetime ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS pv2, --从起点到当前行，结果同pv1 
SUM(pv) OVER(PARTITION BY channel_id) AS pv3,								--分组内所有行
SUM(pv) OVER(PARTITION BY channel_id ORDER BY updatetime ROWS BETWEEN 3 PRECEDING AND CURRENT ROW) AS pv4,   --当前行+往前3行
SUM(pv) OVER(PARTITION BY channel_id ORDER BY updatetime ROWS BETWEEN 3 PRECEDING AND 1 FOLLOWING) AS pv5,    --当前行+往前3行+往后1行
SUM(pv) OVER(PARTITION BY channel_id ORDER BY updatetime ROWS BETWEEN CURRENT ROW AND UNBOUNDED FOLLOWING) AS pv6   ---当前行+往后所有行  
FROM test;
```
pv1: 分组内从起点到当前行的pv累积，如，11号的pv1=10号的pv+11号的pv, 12号=10号+11号+12号  
pv2: 同pv1  
pv3: 分组内所有的pv累加  
pv4: 分组内当前行+往前3行，如，11号=10号+11号， 12号=10号+11号+12号， 13号=10号+11号+12号+13号， 14号=11号+12号+13号+14号  
pv5: 分组内当前行+往前3行+往后1行，如，14号=11号+12号+13号+14号+15号=5+7+3+2+4=21  
pv6: 分组内当前行+往后所有行，如，13号=13号+14号+15号+16号=3+2+4+4=13，14号=14号+15号+16号=2+4+4=10  



